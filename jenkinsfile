pipeline {
    agent any
    
    environment {
        GITHUB_TOKEN = credentials('github-token-id')
        REPO_OWNER = 'titanrex'
        REPO_NAME = 'terraform'
        NEW_FOLDER_NAME = "${params.NEW_FOLDER_NAME}" // Usamos el valor del par√°metro ingresado en Jenkins
    }

    stages {
        stage('Create GitHub Folder') {
            steps {
                script {
                    def createFolderResponse = sh(script: """
                        curl -X PUT -H "Authorization: token ${GITHUB_TOKEN}" -d '{
                            "path": "${NEW_FOLDER_NAME}",
                            "message": "Create ${NEW_FOLDER_NAME}",
                            "branch": "main"
                        }' https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${NEW_FOLDER_NAME}
                    """, returnStdout: true).trim()

                    echo "Folder created: ${NEW_FOLDER_NAME}"
                }
            }
        }
    }
}

